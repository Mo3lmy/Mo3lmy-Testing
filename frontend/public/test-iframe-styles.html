<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .controls {
            width: 300px;
            padding: 20px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .preview {
            flex: 1;
            padding: 20px;
        }
        button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #slideFrame {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h2>ğŸ¨ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª</h2>

            <label>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>
            <select id="grade">
                <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« (Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ)</option>
                <option value="6">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ (Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ)</option>
                <option value="8">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù† (Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ)</option>
                <option value="11">Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø± (Ø«Ø§Ù†ÙˆÙŠ)</option>
            </select>

            <label>Ù†ÙˆØ¹ Ø§Ù„Ø´Ø±ÙŠØ­Ø©:</label>
            <select id="slideType">
                <option value="title">Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</option>
                <option value="content">Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</option>
                <option value="bullet">Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ù†Ù‚Ø§Ø·</option>
                <option value="quiz">Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</option>
            </select>

            <button onclick="testDirectAPI()">ğŸ”¬ Ø§Ø®ØªØ¨Ø§Ø± API Ù…Ø¨Ø§Ø´Ø±</button>
            <button onclick="testBlobURL()">ğŸ“¦ Ø§Ø®ØªØ¨Ø§Ø± Blob URL</button>
            <button onclick="testSrcDoc()">ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± SrcDoc</button>
            <button onclick="testDataURL()">ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Data URL</button>

            <hr>
            <h3>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h3>
            <div id="results" style="font-size: 12px; color: #666;">
                Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±...
            </div>
        </div>

        <div class="preview">
            <iframe id="slideFrame"></iframe>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';

        async function testDirectAPI() {
            log('ğŸ”¬ Testing Direct API...');
            const grade = document.getElementById('grade').value;
            const type = document.getElementById('slideType').value;

            try {
                const response = await fetch(`${API_BASE}/test/slides/preview/${type}?grade=${grade}`);
                const html = await response.text();

                log(`âœ… Received HTML: ${html.length} chars`);
                log(`ğŸ¨ Has styles: ${html.includes('<style>')}`);

                // Ø¹Ø±Ø¶ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Blob URL
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                document.getElementById('slideFrame').src = url;

            } catch (error) {
                log(`âŒ Error: ${error.message}`, 'error');
            }
        }

        async function testBlobURL() {
            log('ğŸ“¦ Testing Blob URL...');
            const html = await generateTestHTML();

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            document.getElementById('slideFrame').src = url;

            log(`âœ… Blob URL created: ${url.substring(0, 50)}...`);
        }

        async function testSrcDoc() {
            log('ğŸ“ Testing SrcDoc...');
            const html = await generateTestHTML();

            document.getElementById('slideFrame').srcdoc = html;
            log(`âœ… SrcDoc applied: ${html.length} chars`);
        }

        async function testDataURL() {
            log('ğŸ”— Testing Data URL...');
            const html = await generateTestHTML();

            const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(html)}`;
            document.getElementById('slideFrame').src = dataUrl;

            log(`âœ… Data URL created: ${dataUrl.length} chars`);
        }

        async function generateTestHTML() {
            const grade = parseInt(document.getElementById('grade').value);
            const type = document.getElementById('slideType').value;

            // Ù…Ø­Ø§ÙƒØ§Ø© HTML Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
            const isKids = grade <= 6;
            const isTeen = grade <= 9;

            return `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Tajawal', sans-serif;
                            direction: rtl;
                            height: 100vh;
                            background: ${isKids ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' :
                                         isTeen ? 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' :
                                                 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'};
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                        .content {
                            text-align: center;
                            color: white;
                            padding: 40px;
                            ${isKids ? 'animation: bounce 2s infinite;' : ''}
                        }
                        h1 {
                            font-size: ${isKids ? '4em' : '3em'};
                            margin-bottom: 20px;
                            ${isKids ? 'text-shadow: 3px 3px 0 rgba(0,0,0,0.2);' : ''}
                        }
                        ${isKids ? `
                            @keyframes bounce {
                                0%, 100% { transform: translateY(0); }
                                50% { transform: translateY(-20px); }
                            }
                            .emoji {
                                font-size: 5em;
                                animation: spin 3s linear infinite;
                            }
                            @keyframes spin {
                                from { transform: rotate(0deg); }
                                to { transform: rotate(360deg); }
                            }
                        ` : ''}
                    </style>
                </head>
                <body>
                    <div class="content">
                        <h1>Ø´Ø±ÙŠØ­Ø© ${type === 'title' ? 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†' : 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰'}</h1>
                        <p>Ù…ØµÙ…Ù…Ø© Ù„Ù„ØµÙ ${grade}</p>
                        ${isKids ? '<div class="emoji">ğŸš€</div>' : ''}
                    </div>
                </body>
                </html>
            `;
        }

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const time = new Date().toLocaleTimeString('ar-EG');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : '#666';
            results.innerHTML = `<div style="color: ${color}">[${time}] ${message}</div>` + results.innerHTML;
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆÙ„ÙŠ
        testDirectAPI();
    </script>
</body>
</html>