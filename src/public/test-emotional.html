<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Student Context</h1>
    
    <div id="status">ØºÙŠØ± Ù…ØªØµÙ„</div>
    <div id="context"></div>
    <div id="emotional"></div>
    
    <button onclick="simulateFrustration()">Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø­Ø¨Ø§Ø·</button>
    <button onclick="simulateSuccess()">Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¬Ø§Ø­</button>
    <button onclick="submitWrongAnswers()">3 Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®Ø§Ø·Ø¦Ø©</button>
    
    <script>
        const socket = io('http://localhost:3000');
        
        // Authenticate
        socket.on('connect', () => {
            socket.emit('authenticate', { token: 'dev-token' });
        });
        
        socket.on('authenticated', (data) => {
            document.getElementById('status').innerHTML = `
                <h3>âœ… Ù…ØªØµÙ„</h3>
                <p>${data.greeting}</p>
                <p>Ø§Ù„Ù…Ø²Ø§Ø¬: ${data.context?.mood || 'neutral'}</p>
                <p>Streak: ${data.context?.streakCount || 0}</p>
            `;
        });
        
        // Listen for emotional state updates
        socket.on('emotional_state_updated', (data) => {
            document.getElementById('emotional').innerHTML = `
                <h3>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ©:</h3>
                <p>Ø§Ù„Ù…Ø²Ø§Ø¬: ${data.state.mood}</p>
                <p>Ø§Ù„Ø«Ù‚Ø©: ${data.state.confidence}%</p>
                <p>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: ${data.state.engagement}%</p>
                <p>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª: ${data.suggestions.join(', ')}</p>
            `;
        });
        
        // Listen for achievements
        socket.on('achievement_unlocked', (data) => {
            alert(`ğŸ† Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯: ${data.title}`);
        });
        
        // Listen for help offers
        socket.on('help_offered', (data) => {
            if(confirm(data.message)) {
                console.log('User needs help');
            }
        });
        
        // Listen for break suggestions
        socket.on('break_suggested', (data) => {
            alert(`â° ${data.message}`);
        });
        
        // Test functions
        function simulateFrustration() {
            socket.emit('update_emotional_state', {
                indicators: ['multiple_errors', 'slow_response']
            });
        }
        
        function simulateSuccess() {
            socket.emit('user_activity', {
                type: 'answer_submitted',
                correct: true
            });
        }
        
        function submitWrongAnswers() {
            for(let i = 0; i < 3; i++) {
                socket.emit('user_activity', {
                    type: 'answer_submitted',
                    correct: false
                });
            }
        }
    </script>
</body>
</html>